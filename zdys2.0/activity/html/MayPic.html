<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta http-equiv="pragma" content="no-cache"/>
    <meta http-equiv="content-type" content="no-cache, must-revalidate"/>
    <meta http-equiv="expires" content="Wed, 26 Feb 1997 08:21:57 GMT"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <meta http-equiv="Cache-Control" content="no-transform"/>
    <meta name="apple-mobile-web-app-title" content="找对医生"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-touch-fullscreen" content="yes"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="keywords" content="找对医生,家庭医生">
    <meta name="description" content="找对医生">
    <meta name="copyright" content="www.zhaoduiyisheng.com"/>
    <link rel="shortcut icon" href="/favicon.ico"/>
    <title>找对医生</title>
    <link href="../../css/base.css?v=1" rel="stylesheet"/>
    <style>.main-wrap{height:100%;background-color:#ffadb7}img{display:block;width:100%}footer{top:-.25rem;padding-bottom:.4rem}section{background:url(../img/MayDay/may2_bg.jpg) no-repeat center top;background-size:cover;display:block}.info{height:2rem}.to-top{color:#ff4659;top:0;padding:.5rem .2rem .2rem}.my-info{width:4.3rem;margin:0 auto}.my-pic{width:1.3rem;height:1.3rem;background-repeat:no-repeat;background-position:center;background-color:#ccc;background-size:cover}.more-info{padding-left:.2rem}.more-info>p{width:2.7rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:#ed4c5d;line-height:.44rem}.no-info{color:#fff;background-color:#ed4f5f;padding:.2rem .9rem;display:inline-block;margin-top:.2rem}.sea{width:4rem;margin-left:.6rem}.sea-left{height:.66rem;width:3.09rem;background:url(../img/MayDay/icon-zoom.png) no-repeat left center;background-size:.4rem;border:1px solid #808080;border-right:0;-webkit-border-radius:5px 0 0 5px;border-radius:5px 0 0 5px}#inp{border:0;background:transparent;width:2.5rem;border-left:1px solid #808080;padding-left:.1rem;line-height:.3rem;height:.3rem;border-radius:0;left:.5rem}.sea-right{height:.66rem;line-height:.66rem;width:.88rem;background-color:#ed5665;-webkit-border-radius:0 5px 5px 0;border-radius:0 5px 5px 0;color:#fff}.sort{width:2rem;height:.66rem;line-height:.62rem;border:1px solid #808080;margin-right:.5rem}.sort-left{color:#808080;width:1.2rem}.sort-right{width:.72rem;height:.64rem;background:url(../img/MayDay/arrow-b.png) no-repeat center;background-size:.4rem;border-left:1px solid #808080}.sort-menu{width:2rem;height:1.72rem;background-color:rgba(0,0,0,.5);left:0;top:.86rem;color:#fff;z-index:3}.sort-menu::before{content:"";position:absolute;width:.33rem;height:.14rem;background:url(../img/MayDay/arrow.png) no-repeat bottom;background-size:cover;top:-.14rem;left:.5rem}.sort-menu>div{line-height:.85rem;height:.85rem;width:90%;margin:0 auto}.sort-menu>div:nth-child(1){border-bottom:1px solid #fff}.picul{width:6.9rem;margin:.6rem auto .8rem}.pics{height:4.46rem;width:3.14rem;margin:0 .15rem .22rem;float:left}.pic-bg{height:3.14rem;background-color:#bfbfbf;background-size:100%;background-repeat:no-repeat;background-position:center;-webkit-border-radius:5px 5px 0 0;border-radius:5px 5px 0 0}.pic-info{height:1.32rem;background-color:#fff;-webkit-border-radius:0 0 12px 5px;border-radius:0 0 12px 5px}.name{width:43%}.num{width:57%}.ticket{width:75%}.name,.ticket,.num{text-indent:.15rem;line-height:.66rem;float:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.go-vote{height:.75rem;width:.75rem;background:#ee5464 url(../img/MayDay/hand.png) no-repeat center;background-size:.5rem;-webkit-border-radius:999px;border-radius:999px;right:0;bottom:-.1rem}.page{width:6.9rem;margin:0 auto}.page>em{display:inline-block;width:.6rem;height:.6rem;line-height:.56rem;border:1px solid #808080;color:#333;-webkit-border-radius:5px;border-radius:5px}.page>.now{border-color:#ee5464;background-color:#ee5464;color:#fff}.page>.ell{border:0}.page>:first-child,.page>:last-child{width:auto;padding:0 .15rem}.page>.able{border-color:#ee5464;color:#ee5464}.page>.disable{border-color:#999;color:#999}.qr{padding-top:1rem}.qr>img{width:2.8rem;-webkit-box-shadow:0 0 5px 5px rgba(0,0,0,.3);box-shadow:0 0 5px 1px rgba(0,0,0,.3);margin:0 auto .2rem}.qr>p{padding-bottom:1rem}.fc{color:#ef6170}.br5{-webkit-border-radius:5px;border-radius:5px}.f28{font-size:14px}.f30{font-size:15px}.f32{font-size:16px}.f34{font-size:17px}.pop-wrap{position:absolute;z-index:999;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.5)}.dia-wrap{padding:.74rem .86rem 0}.diaContent{width:5.8rem;height:6.32rem;background:url("../img/MayDay/may_pop.jpg") no-repeat;background-size:cover;border-radius:20px  20px 0 0;padding:.50rem .86rem 0 .86rem;font-size:.28rem}.diaContent h2{font-size:.48rem}.regPhone{width:100%;border-radius:8px;border:none;position:relative;background:#ffffff url(../img/topicsActivity/reg_icon_01.png) no-repeat .1rem center;background-size:11%;height:.66rem;padding-left:.56rem;font-size:.28rem;margin-top:.8rem}.regNum{width:55%;height:.66rem;float:left;border:none;border-radius:8px 0 0 8px;-webkit-border-radius:8px 0 0 8px;background:#ffffff url(../img/topicsActivity/reg_icon_02.png) no-repeat .1rem center;background-size:20%;padding-left:.56rem;font-size:.28rem}.getRegNum{display:block;width:45%;height:.66rem;border-radius:0 8px 8px 0;-webkit-border-radius:0 8px 8px 0;color:rgba(255,255,255,.85);text-align:center;font-size:.28rem;background:#1ea8de;float:left;line-height:.66rem}.confirm{display:block;width:100%;height:.88rem;line-height:.88rem;font-size:.34rem;color:#ffffff;text-align:center;background:#ee495a;border-radius:0 0 20px  20px}.failContent{background:#ee495a;color:#ffffff;font-size:.34rem;border-radius:20px;width:5.8rem;text-align:center;padding:2rem .3rem}.pop-con{width:5.80rem;border-radius:20px}.closePop{position:absolute;bottom:11.12%;left:50%;-webkit-transform:translate3d(-50%,0,0);transform:translate3d(-50%,0,0);width:0.76rem;height:0.76rem;background:url(../img/topicsActivity/close.png) no-repeat center;background-size:cover}@media screen and (width:320px){html{font-size:42.6667px!important}.diaContent{padding-top:.1rem}.closePop{bottom:2%}}@media screen and (max-width:361px) and (min-width:341px){.closePop{bottom:4%}}.back{position: absolute; top: 0.3rem; left: 0.3rem;display: block; width: .6rem; height: .6rem; background: url(http://imgcdn.zhaoduiyisheng.com/img/icon/back_white_03.png) rgba(0, 0, 0, .48) no-repeat center;background-size: .48rem;}</style>
</head>
<body>
<script>
    function setfont() {
        var clientWidth = document.body.clientWidth || document.documentElement.clientWidth;
        if (clientWidth > 750) {
            clientWidth = 750;
        }
        document.documentElement.style.fontSize = clientWidth / 7.5 + 'px';
    }
    setfont();
    window.addEventListener('resize', setfont);
    if (!window.localStorage.openid&&!window.sessionStorage.n){
     window.sessionStorage.n = ' ';
     var appId="wx14da7f3cb2e1b8ff";
     var redirect_uri=encodeURI(window.location.origin+window.location.pathname);
     window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+appId+"&redirect_uri="+redirect_uri+
     "&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect";
     }
</script>
<div class="main-wrap" id="main">
    <div>
        <header>
            <img src="../img/MayDay/may2_top.jpg" alt="">
        </header>
        <a class="back"  href="May.html"></a>
        <section>
            <div class="info tc pr">
                <div id="my-info" class="my-info cbo center dn">
                    <div class="my-pic br5 fl" id="my-pic"></div>
                    <div class="more-info fl tl">
                        <p id="name" class="f34"></p>
                        <p class="f28">编号：<span id="number"></span></p>
                        <p class="f28">票数：<span id="votenum"></span></p>
                    </div>
                </div>
                <a id="no-info" class="no-info br5 f34 dn" href="May.html">我也要晒手</a>
            </div>
            <div class="search clearfix">
                <div class="sea f30 fl">
                    <div class="sea-left fl pr">
                        <input class="centerY" id="inp" type="tel" placeholder="请输入编号">
                    </div>
                    <div class="sea-right fl tc" id="sure">确定</div>
                </div>
                <div class="sort br5 fr f30 tc pr" id="show-sort">
                    <div class="sort-left fl" id="sort-txt">排序</div>
                    <div class="sort-right fr"></div>
                    <div class="sort-menu pa br5 dn" id="go-sort">
                        <div data-sort="totalVotes">按票数</div>
                        <div data-sort="serialNumber">按编号</div>
                    </div>
                </div>
            </div>
            <div id="picul" class="picul clearfix">
                <!-- <div class="pics">
                    <div class="pic-bg"></div>
                    <div class="pic-info f30 pr">
                        <p class="name c-66">张三三三</p><p class="num c-99">编号:8888</p><p class="ticket c-99">票数:888</p>
                        <div class="go-vote pa"></div>
                    </div>
                </div> -->
            </div>
            <div class="page tc f30" id="page">
                <em class="prev disable" href="">上一页</em>
                <em class="now em" id="page1" href="">1</em>
                <em class="dn em" href=""></em>
                <em class="dn em" href=""></em>
                <em class="dn em" href=""></em>
                <!-- <em class="ell" href="">...</em> -->
                <em class="dn em" href=""></em>
                <em class="next able" href="">下一页</em>
            </div>
            <div class="qr">
                <img src="http://imgcdn.zhaoduiyisheng.com/img/icon/vip_erwm.jpg" alt="" class="scr">
                <p class="tc f28 fc">关注找对e生,名医/福利这都有</p>
            </div>
        </section>
        <footer class="pr">
            <img src="../img/MayDay/may2_bottom.png" alt="">
            <p id="to-top" class="to-top pa f28 centerX">回到顶部</p>
        </footer>
    </div>
</div>
<div class="pop-wrap dn" id="pop-window">
    <!--绑定手机号-->
    <div class="dia-wrap  center" id="bindPhone">
        <div class="diaContent">
            <h2 class="f40 c-white tc">绑定手机号</h2>
            <p class="f24 mt20 tl c-white mb40">为了验证是您本人操作，请验证手机号</p>
            <input type="tel" class="regPhone" id="regPhone" placeholder="输入手机号">
            <div class="mt30 cbo">
                <input type="tel" id="regNum" class="regNum" placeholder="输入验证码">
                <span class="getRegNum" id="getRegNum">获取验证码</span>
            </div>
            <p class="tc c-red f28 mt30" id="notice"></p>
        </div>
        <span class="confirm" id="btnSubmit">确定</span>
    </div>
    <span class="db closePop" id="closeThis"></span>
</div>

<script src="../../lib/jquery-2.1.4.min.js"></script>
<script src="../../lib/swiper.min.js"></script>
<script src="../../lib/jquery.touchSwipe.min.js"></script>
<script src="../../lib/iscroll.min.js"></script>
<script src="../../js/base.js"></script>
<script>
    weixinLogin();
    var scroll = new IScroll('#main', {probeType: 3, mouseWheel: true});
    $(document).one('touchstart',function(){
        scroll.refresh();
    });
    $('#show-sort').swipe({
        tap:function(){
            $('#go-sort').toggleClass('dn');
        }
    });
    $('#go-sort>div').swipe({
        tap:function(){
            $('#sort-txt').text(this.text());
            if(this.data('sort')!==sortBy){
                sortBy = this.data('sort');
                getList(1,sortBy);
            }
        }
    });
    $('#picul').swipe({
        tap:function(e,t){
            if($(t).hasClass('go-vote')){
                  toVote($(t));
            }
        }
    });
    $('#closeThis').swipe({
        tap:function(e,t){
            $('#pop-window').addClass('dn');
            e.preventDefault();
        }
    });
    function toVote(obj){
        $.ajax({
                    type: "POST",
                    url: ajaxUrl + 'Promotion/LaborHand/Vote?sessionId=' + window.localStorage.sessionId,
                    contentType: "text/plain; charset=UTF-8",
                    dataType: 'json',
                    data:obj.data('num'),
                    success: function(data) {
                        if (0 === data.code) {
                            myalert.tips({
                                txt: "投票成功",
                                btn: 1
                            });
                            obj.prev().text('票数:'+data.data);
                        }else if (909 == data.code) {
                            myalert.tips({
                                txt: '请先登录',
                                btn: 1,
                                fnok:function(){
                                    window.location='/html/newLogin.html';
                                }
                            });
                        }else{
                            myalert.tips({
                                txt: data.message,
                                btn: 1
                            });
                        }
                    },
                    error: function(res) {
                        myalert.tips({
                            txt: "会话超时，请重新登录",
                            fnok: function() {
                                window.location = "/html/newLogin.html";
                            },
                            btn: 1
                        });
                    }
                });
    }
    $('#sure').swipe({
        tap:function(){
            getList(1,sortBy,$('#inp').val());
        }
    });
    var sortBy='serialNumber',
    nowpage = 1,
    allpage=0,
    num = $('#page>.em'),
    prev=$('#page>.prev'),
    next=$('#page>.next');
    prev.swipe({
        tap:function(){
            if (!$(this).hasClass('disable')) {
                nowpage--;
                getList(nowpage,sortBy);
            }
        }
    });
    next.swipe({
        tap:function(){
            if (!$(this).hasClass('disable')) {
                nowpage++;
                getList(nowpage,sortBy);
            }
        }
    });
    num.swipe({
        tap:function(){
            if ('...'!==$(this).text()&&!$(this).hasClass('now')) {
                nowpage=$(this).text();
                getList(nowpage,sortBy);
            }
        }
    });
    $.ajax({
        type: "GET",
        url: ajaxUrl + "Promotion/LaborHand/MyPicture?sessionId=" + window.localStorage.sessionId,
        contentType: "text/plain; charset=UTF-8",
        dataType: 'json',
        success: function(data) {
            if (0 === data.code&&data.data) {
                console.log(data.data.imageUrl);
                $('#my-pic').css('background-image','url('+data.data.imageUrl+')');
                $('#name').text(data.data.userName);
                $('#number').text(data.data.serialString);
                $('#votenum').text(data.data.totalVotes);
                $('#my-info').removeClass('dn');
            } else {
                $('#no-info').removeClass('dn');
            }
        },
        error: function(res) {
                $('#no-info').removeClass('dn');
        }
    });
    function getList(n,way,search){
        var url=ajaxUrl + "Promotion/LaborHand/List?page="+n+'&sortBy='+way;
        if(search){
            url+='&serialNumber='+search;
        }
        $.ajax({
            type: "GET",
            url: url,
            contentType: "text/plain; charset=UTF-8",
            dataType: 'json',
            success: function(data) {
                if (0 === data.code&&data.data) {
                    var list = data.data.dataList,
                      len = list.length,
                      str = '';
                    for(var i=0;i<len;i++){
                        str+='<div class="pics"><div class="pic-bg" style="background-image:url('+list[i].imageUrl+')"></div><div class="pic-info f30 pr"><p class="name c-66">'+list[i].userName+'</p><p class="num c-99">编号:'+list[i].serialString+'</p><p class="ticket c-99">票数:'+list[i].totalVotes+'</p><div class="go-vote pa" data-num="'+list[i].serialString+'"></div></div></div>';
                    }
                    $('#picul').empty().append(str);
                    scroll.refresh();
                    num.addClass('dn').removeClass('now ell');
                    allpage = data.data.pageCount;
                    if (nowpage>1) {
                        prev.removeClass('disable').addClass('able');
                    }else{
                        prev.addClass('disable').removeClass('able');
                    }
                    if (nowpage==allpage) {
                        next.addClass('disable').removeClass('able');
                    }else{
                        next.removeClass('disable').addClass('able');
                    }
                    if (allpage<=5) {
                        for(i=0;i<allpage;i++){
                            num.eq(i).removeClass('dn').text(i+1);
                            if(n==(i+1)){num.eq(i).addClass('now');}
                        }
                    }else{
                        if ((nowpage-1)<3) {
                            for(i=0;i<3;i++){
                                num.eq(i).removeClass('dn').text(i+1);
                                if(n==(i+1)){num.eq(i).addClass('now');}
                            }
                            num.eq(3).removeClass('dn').addClass('ell').text('...');
                            num.eq(4).removeClass('dn').text(allpage);
                        }else if((allpage-nowpage)<3){
                            for(i=0;i<3;i++){
                                num.eq(num.length-1-i).removeClass('dn').text(allpage-i);
                                if(n==(allpage-i)){num.eq(num.length-1-i).addClass('now');}
                            }
                            num.eq(1).removeClass('dn').addClass('ell').text('...');
                            num.eq(0).removeClass('dn').text(1);
                        }else{
                            num.eq(0).removeClass('dn').text(1);
                            num.eq(1).removeClass('dn').addClass('ell').text('...');
                            num.eq(2).removeClass('dn').addClass('now').text(nowpage);
                            num.eq(3).removeClass('dn').addClass('ell').text('...');
                            num.eq(4).removeClass('dn').text(allpage);
                        }

                    }
                }
            }
        });
    }
    getList(1,sortBy);
    // 回到顶部
    $('#to-top').on('click',function(){
        scroll.scrollTo(0,0,200);
    });
    shareWeixin('最美劳动手一定是我妈哒！快来帮我~','戳戳戳，还可能掉下红包来','http://www-test.zhaoduiyisheng.com/activity/html/MayPic.html','../img/MayDay/face.jpg');
</script>
</body>
</html>
